-- change broker_list and sector_name:
-- change cust_id:
-- change acct_id:
-- change acct_id, cust_id, ending_co_id, starting_co_id, industry_name, start_date:
-- change symbol:
-- change symbol:
-- change symbol:
-- change max_rows_to_return, start_day, symbol:
-- change symbol:
-- change symbol:
-- change trade_id:


SELECT b_name AS broker_name, SUM(tr_qty * tr_bid_price) AS volume FROM trade_request JOIN security ON tr_s_symb = s_symb JOIN company ON s_co_id = co_id JOIN industry ON co_in_id = in_id JOIN sector ON sc_id = in_sc_id JOIN broker ON tr_b_id = b_id WHERE b_name IN (SELECT broker_name FROM broker_list) AND sc_name = sector_name GROUP BY b_name ORDER BY 2 DESC;
SELECT c_st_id AS c_st_id, c_l_name AS c_l_name, c_f_name AS c_f_name, c_m_name AS c_m_name, c_gndr AS c_gndr, c_tier AS c_tier, c_dob AS c_dob, c_ad_id AS c_ad_id, c_ctry_1 AS c_ctry_1, c_area_1 AS c_area_1, c_local_1 AS c_local_1, c_ext_1 AS c_ext_1, c_ctry_2 AS c_ctry_2, c_area_2 AS c_area_2, c_local_2 AS c_local_2, c_ext_2 AS c_ext_2, c_ctry_3 AS c_ctry_3, c_area_3 AS c_area_3, c_local_3 AS c_local_3, c_ext_3 AS c_ext_3, c_email_1 AS c_email_1, c_email_2 AS c_email_2 FROM customer WHERE c_id = cust_id; SELECT ca_id AS acct_id, ca_bal AS cash_bal, COALESCE(SUM(hs_qty * lt_price), 0) AS assets_total FROM customer_account LEFT OUTER JOIN holding_summary ON hs_ca_id = ca_id JOIN last_trade ON lt_s_symb = hs_s_symb WHERE ca_c_id = cust_id GROUP BY ca_id, ca_bal ORDER BY 3 ASC LIMIT 10;
SELECT t_id AS trade_id, t_s_symb AS symbol, t_qty AS qty, st_name AS trade_status, th_dts AS hist_dts FROM (SELECT t_id AS ID FROM trade WHERE t_ca_id = acct_id ORDER BY t_dts DESC LIMIT 10) AS t JOIN trade ON t_id = ID JOIN trade_history ON th_t_id = t_id JOIN status_type ON st_id = th_st_id ORDER BY th_dts DESC LIMIT 30;
WITH symbol_list AS (SELECT wi_s_symb AS symbol FROM watch_item JOIN watch_list ON wi_wl_id = wl_id WHERE cust_id != 0 AND wl_c_id = cust_id UNION ALL SELECT s_symb AS symbol FROM industry JOIN company ON co_in_id = in_id JOIN security ON s_co_id = co_id WHERE industry_name != '' AND in_name = industry_name AND co_id BETWEEN starting_co_id AND ending_co_id UNION ALL SELECT hs_s_symb AS symbol FROM holding_summary WHERE acct_id != 0 AND hs_ca_id = acct_id) SELECT SUM(COALESCE(s_num_out * dm_close, 0)) AS old_mkt_cap, SUM(COALESCE(s_num_out * lt_price, 0)) AS new_mkt_cap, CASE WHEN SUM(COALESCE(s_num_out * dm_close, 0)) != 0 THEN 100 * (SUM(COALESCE(s_num_out * lt_price, 0)) / SUM(COALESCE(s_num_out * dm_close, 0)) - 1) ELSE 0.0 END AS pct_change FROM symbol_list LEFT JOIN security ON symbol_list.symbol = security.s_symb LEFT JOIN daily_market ON symbol_list.symbol = daily_market.dm_s_symb AND daily_market.dm_date = start_date LEFT JOIN last_trade ON symbol_list.symbol = last_trade.lt_s_symb;
SELECT s_name AS s_name, co_id, co_name, co_sp_rate AS sp_rate, co_ceo, co_desc, co_open_date AS open_date, co_st_id AS co_st_id, co_ad_line1, co_ad_line2, zca.zc_town AS co_ad_town, zca.zc_div AS co_ad_div, ca.ad_zc_code AS co_ad_zip, ca.ad_ctry AS co_ad_ctry, s_num_out AS num_out, s_start_date AS start_date, s_exch_date AS exch_date, s_pe AS pe_ratio, s_52wk_high AS 52_wk_high, s_52wk_high_date AS 52_wk_high_date, s_52wk_low AS 52_wk_low, s_52wk_low_date AS 52_wk_low_date, s_dividend AS divid, s_yield AS yield, zea.zc_div AS ex_ad_div, ea.ad_ctry AS ex_ad_ctry, ea.ad_line1 AS ex_ad_line1, ea.ad_line2 AS ex_ad_line2, zea.zc_town AS ex_ad_town, ea.ad_zc_code AS ex_ad_zip, ex_close AS ex_close, ex_desc AS ex_desc, ex_name AS ex_name, ex_num_symb AS ex_num_symb, ex_open AS ex_open FROM security, company, address ca, address ea, zip_code zca, zip_code zea, exchange WHERE s_symb = symbol AND co_id = s_co_id AND ca.ad_id = co_ad_id AND ea.ad_id = ex_ad_id AND ex_id = s_ex_id AND ca.ad_zc_code = zca.zc_code AND ea.ad_zc_code = zea.zc_code;
SELECT company.co_name AS cp_co_name, industry.in_name AS cp_in_name FROM company_competitor, company, industry, security WHERE security.symb=symbol AND company_competitor.cp_co_id = security.s_co_id AND company.co_id = company_competitor.cp_comp_co_id AND industry.in_id = company_competitor.cp_in_id LIMIT 3;
SELECT fi_year AS year, fi_qtr AS qtr, fi_qtr_start_date AS start_date, fi_revenue AS rev, fi_net_earn AS net_earn, fi_basic_eps AS basic_eps, fi_dilut_eps AS dilut_eps, fi_margin AS margin, fi_inventory AS invent, fi_assets AS assets, fi_liability AS liab, fi_out_basic AS out_basic, fi_out_dilut AS out_dilut FROM financial, security WHERE s_symb = symbol AND fi_co_id = s_co_id ORDER BY fi_year ASC, fi_qtr ASC LIMIT 20;
SELECT dm_date AS dm_date, dm_close AS close, dm_high AS high, dm_low AS low, dm_vol AS vol FROM daily_market WHERE dm_s_symb = symbol AND dm_date >= start_day ORDER BY dm_date ASC LIMIT max_rows_to_return;
SELECT lt_price AS last_price, lt_open_price AS last_open, lt_vol AS last_vol FROM last_trade WHERE lt_s_symb = symbol;
SELECT ni_item AS item, ni_dts AS dts, ni_source AS src, ni_author AS auth, ni_headline AS headline, ni_summary AS summary FROM news_xref, news_item, security WHERE s_symb=symbol AND ni_id = nx_ni_id AND nx_co_id = s_co_id ORDER BY ni_dts ASC LIMIT 2;
SELECT t_bid_price AS bid_price, t_exec_name AS exec_name, t_is_cash AS is_cash, tt_is_mrkt AS is_market, t_trade_price AS trade_price FROM trade, trade_type WHERE t_id = trade_id AND t_tt_id = tt_id;